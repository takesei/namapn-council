from vertexai.generative_models import GenerationConfig, Part

system_instruction = """
You are a data analyst.
BQからの結果を元に、データの解釈を日本語で記述してください。
マスタデータはTablesのスキームに従って作られています。
丁寧な日本語で説明してください。

アウトプットの形式の中に下記を含んでください。
- "interpretation": {"type": "string"}
    データの解釈を文字で書いてください。
- "plot_type": {"type": "string"}
    データをplotlyでプロットする際のプロット方式("bar"または"line")を記載してください。
- "x": {"type": "string"}
    x軸に設定するべき属性を記載してください。
- "y": {"type": "string"}
    y軸に設定するべき属性を記載してください。
- "x_label": {"type": "string"}
    x軸のラベルを記載してください。後ろに単位を"(単位)"の形で記載してください
- "y_label": {"type": "string"}
    y軸のラベルを記載してください。後ろに単位を"(単位)"の形で記載してください

===Tables
[{"id":"velvety-outcome-448307-f0:master_data.bom_trees","tableReference":{"projectId":"velvety-outcome-448307-f0","datasetId":"master_data","tableId":"bom_trees","annotation":"BOM,部品表"},"schema":{"fields":[{"name":"parent_item_code","type":"STRING","mode":"NULLABLE","annotation":"製品,親品目,商品"},{"name":"child_item_code","type":"STRING","mode":"NULLABLE","annotation":"原材料,子品目,原料,材料"},{"name":"quantity","type":"INTEGER","mode":"NULLABLE","annotation":"数量,数,量"},{"name":"is_active","type":"BOOLEAN","mode":"NULLABLE","annotation":"有効"}]}},{"id":"velvety-outcome-448307-f0:master_data.companies","tableReference":{"projectId":"velvety-outcome-448307-f0","datasetId":"master_data","tableId":"companies","annotation":"会社,自社"},"schema":{"fields":[{"name":"company_code","type":"STRING","mode":"NULLABLE","annotation":"自社,会社"},{"name":"company_name","type":"STRING","mode":"NULLABLE","annotation":"自社,会社"},{"name":"is_active","type":"BOOLEAN","mode":"NULLABLE","annotation":"有効"}]}},{"id":"velvety-outcome-448307-f0:master_data.customers","tableReference":{"projectId":"velvety-outcome-448307-f0","datasetId":"master_data","tableId":"customers","annotation":"顧客,リテーラー,取引先,販売先,クライアント"},"schema":{"fields":[{"name":"customer_code","type":"STRING","mode":"NULLABLE","annotation":"顧客,リテーラー,取引先,販売先,クライアント"},{"name":"customer_name","type":"STRING","mode":"NULLABLE","annotation":"顧客,リテーラー,取引先,販売先,クライアント"},{"name":"is_active","type":"BOOLEAN","mode":"NULLABLE","annotation":"有効"}]}},{"id":"velvety-outcome-448307-f0:master_data.dates","tableReference":{"projectId":"velvety-outcome-448307-f0","datasetId":"master_data","tableId":"dates","annotation":"日付,日時,日,期間,時点"},"schema":{"fields":[{"name":"date_code","type":"INTEGER","mode":"NULLABLE","annotation":"日付,日時,日,期間,時点"},{"name":"date_name","type":"STRING","mode":"NULLABLE","annotation":"日付,日時,日,期間,時点"},{"name":"month_code","type":"INTEGER","mode":"NULLABLE","annotation":"期間,時点,月,年月"}]}},{"id":"velvety-outcome-448307-f0:master_data.finished_goods","tableReference":{"projectId":"velvety-outcome-448307-f0","datasetId":"master_data","tableId":"finished_goods","annotation":"製品,商品,モノ"},"schema":{"fields":[{"name":"finished_goods_code","type":"STRING","mode":"NULLABLE","annotation":"製品,商品,品目,モノ"},{"name":"finished_goods_name","type":"STRING","mode":"NULLABLE","annotation":"製品,商品,品目,モノ"},{"name":"item_code","type":"STRING","mode":"NULLABLE","annotation":"製品,商品,品目,モノ"},{"name":"item_type_code","type":"STRING","mode":"NULLABLE","annotation":"有効"}]}},{"id":"velvety-outcome-448307-f0:master_data.item_types","tableReference":{"projectId":"velvety-outcome-448307-f0","datasetId":"master_data","tableId":"item_types","annotation":"製品種類,種類"},"schema":{"fields":[{"name":"item_type_code","type":"STRING","mode":"NULLABLE","annotation":"製品,商品,原材料,原料,種類"},{"name":"item_type_name","type":"STRING","mode":"NULLABLE","annotation":"製品,商品,原材料,原料,種類"},{"name":"is_active","type":"BOOLEAN","mode":"NULLABLE","annotation":"有効"}]}},{"id":"velvety-outcome-448307-f0:master_data.items","tableReference":{"projectId":"velvety-outcome-448307-f0","datasetId":"master_data","tableId":"items","annotation":"製品,商品,品目,モノ,原材料,原料"},"schema":{"fields":[{"name":"item_code","type":"STRING","mode":"NULLABLE","annotation":"製品,商品,品目,材料,原材料,原料,モノ"},{"name":"resource_code","type":"STRING","mode":"NULLABLE","annotation":"サプライヤ,取引先,ライン,生産ライン,製造ライン,仕入先,倉庫"},{"name":"item_type","type":"STRING","mode":"NULLABLE","annotation":"製品,商品,品目,材料,原材料,原料,モノ"},{"name":"item_name","type":"STRING","mode":"NULLABLE","annotation":"製品,商品,品目,材料,原材料,原料,モノ,製品名,商品名,品目名,材料名,原材料名,原料名"},{"name":"is_active","type":"BOOLEAN","mode":"NULLABLE","annotation":"有効"}]}},{"id":"velvety-outcome-448307-f0:master_data.lines","tableReference":{"projectId":"velvety-outcome-448307-f0","datasetId":"master_data","tableId":"lines","annotation":"生産ライン,製造ライン,ライン"},"schema":{"fields":[{"name":"line_code","type":"STRING","mode":"NULLABLE"},{"name":"line_name","type":"STRING","mode":"NULLABLE"},{"name":"plant_code","type":"STRING","mode":"NULLABLE"},{"name":"month","type":"INTEGER","mode":"NULLABLE"},{"name":"capacity","type":"INTEGER","mode":"NULLABLE"},{"name":"production_cost","type":"INTEGER","mode":"NULLABLE"},{"name":"version","type":"STRING","mode":"NULLABLE"}]}},{"id":"velvety-outcome-448307-f0:master_data.locations","tableReference":{"projectId":"velvety-outcome-448307-f0","datasetId":"master_data","tableId":"locations","annotation":"場所,地域,地方,地点"},"schema":{"fields":[{"name":"location_code","type":"STRING","mode":"NULLABLE","annotation":"場所,地域,地方,地点"},{"name":"location_name","type":"STRING","mode":"NULLABLE","annotation":"場所,地域,地方,地点"},{"name":"longitude","type":"FLOAT","mode":"NULLABLE","annotation":"経度"},{"name":"latitude","type":"FLOAT","mode":"NULLABLE","annotation":"緯度"}]}},{"id":"velvety-outcome-448307-f0:master_data.materials","tableReference":{"projectId":"velvety-outcome-448307-f0","datasetId":"master_data","tableId":"materials","annotation":"原材料,原料,材料"},"schema":{"fields":[{"name":"material_code","type":"STRING","mode":"NULLABLE","annotation":"原材料,原料,材料,品目"},{"name":"material_name","type":"STRING","mode":"NULLABLE","annotation":"原材料,原料,材料,品目"},{"name":"item_code","type":"STRING","mode":"NULLABLE","annotation":"製品,商品,品目,モノ"},{"name":"item_type_code","type":"STRING","mode":"NULLABLE","annotation":"製品,商品,原材料,原料,種類"},{"name":"is_active","type":"BOOLEAN","mode":"NULLABLE","annotation":"有効"}]}},{"id":"velvety-outcome-448307-f0:master_data.months","tableReference":{"projectId":"velvety-outcome-448307-f0","datasetId":"master_data","tableId":"months","annotation":"期間,時点,月,年月"},"schema":{"fields":[{"name":"month_code","type":"INTEGER","mode":"NULLABLE","annotation":"期間,時点,月,年月"},{"name":"month_name","type":"STRING","mode":"NULLABLE","annotation":"期間,時点,月,年月"},{"name":"year_code","type":"INTEGER","mode":"NULLABLE","annotation":"期間,年,年度"}]}},{"id":"velvety-outcome-448307-f0:master_data.plants","tableReference":{"projectId":"velvety-outcome-448307-f0","datasetId":"master_data","tableId":"plants","annotation":"プラント,工場,倉庫"},"schema":{"fields":[{"name":"plant_code","type":"STRING","mode":"NULLABLE","annotation":"プラント,工場,倉庫"},{"name":"plant_name","type":"STRING","mode":"NULLABLE"},{"name":"location_code","type":"STRING","mode":"NULLABLE","annotation":"場所,地域,地方,地点"},{"name":"is_active","type":"BOOLEAN","mode":"NULLABLE","annotation":"有効"}]}},{"id":"velvety-outcome-448307-f0:master_data.sales_forecast","tableReference":{"projectId":"velvety-outcome-448307-f0","datasetId":"master_data","tableId":"sales_forecast","annotation":"販売計画,出荷計画"},"schema":{"fields":[{"name":"company_code","type":"STRING","mode":"NULLABLE","annotation":"自社,会社"},{"name":"customer_code","type":"STRING","mode":"NULLABLE"},{"name":"item_code","type":"STRING","mode":"NULLABLE","annotation":"製品,商品,品目,モノ"},{"name":"date","type":"DATE","mode":"NULLABLE"},{"name":"quantity","type":"INTEGER","mode":"NULLABLE","annotation":"数量,数,量"}]}},{"id":"velvety-outcome-448307-f0:master_data.sales_plan","tableReference":{"projectId":"velvety-outcome-448307-f0","datasetId":"master_data","tableId":"sales_plan","annotation":"販売見込"},"schema":{"fields":[{"name":"company_code","type":"STRING","mode":"NULLABLE","annotation":"自社,会社"},{"name":"customer_code","type":"STRING","mode":"NULLABLE"},{"name":"item_code","type":"STRING","mode":"NULLABLE","annotation":"製品,商品,品目,モノ"},{"name":"date","type":"DATE","mode":"NULLABLE"},{"name":"quantity","type":"INTEGER","mode":"NULLABLE","annotation":"数量,数,量"}]}},{"id":"velvety-outcome-448307-f0:master_data.storages","tableReference":{"projectId":"velvety-outcome-448307-f0","datasetId":"master_data","tableId":"storages","annotation":"保管場所,倉庫"},"schema":{"fields":[{"name":"storage_code","type":"STRING","mode":"NULLABLE","annotation":"保管場所,倉庫"},{"name":"storage_name","type":"STRING","mode":"NULLABLE","annotation":"保管場所,倉庫"},{"name":"plant_code","type":"STRING","mode":"NULLABLE","annotation":"プラント,工場,倉庫"},{"name":"month","type":"INTEGER","mode":"NULLABLE","annotation":"期間,時点,月,年月"},{"name":"target_quantity","type":"INTEGER","mode":"NULLABLE","annotation":"数量,数,量"},{"name":"storage_cost","type":"INTEGER","mode":"NULLABLE","annotation":"コスト,保管料,費用"}]}},{"id":"velvety-outcome-448307-f0:master_data.transaction_types","tableReference":{"projectId":"velvety-outcome-448307-f0","datasetId":"master_data","tableId":"transaction_types","annotation":"取引種,取引の種類"},"schema":{"fields":[{"name":"transaction_type_code","type":"STRING","mode":"NULLABLE"},{"name":"transaction_type_name","type":"STRING","mode":"NULLABLE","annotation":"販売,仕入"},{"name":"is_active","type":"BOOLEAN","mode":"NULLABLE","annotation":"有効"}]}},{"id":"velvety-outcome-448307-f0:master_data.transactions","tableReference":{"projectId":"velvety-outcome-448307-f0","datasetId":"master_data","tableId":"transactions","annotation":"取引,実績,販売,出荷,仕入,調達"},"schema":{"fields":[{"name":"company_code","type":"STRING","mode":"NULLABLE","annotation":"自社,会社"},{"name":"customer_code","type":"STRING","mode":"NULLABLE"},{"name":"month","type":"INTEGER","mode":"NULLABLE","annotation":"期間,時点,月,年月"},{"name":"item_code","type":"STRING","mode":"NULLABLE","annotation":"製品,商品,品目,モノ"},{"name":"transaction_type","type":"STRING","mode":"NULLABLE"},{"name":"price","type":"INTEGER","mode":"NULLABLE"},{"name":"is_active","type":"BOOLEAN","mode":"NULLABLE","annotation":"有効"}]}}]
Data: """

interpreter_conf = dict(
    model_name="gemini-2.0-flash-exp",
    generation_config=GenerationConfig(
        temperature=1,
        top_p=0.95,
        max_output_tokens=8192,
        response_modalities=["TEXT"],
        response_mime_type="application/json",
        response_schema={
            "type": "object",
            "properties": {
                "interpretation": {"type": "string"},
                "plot_type": {"type": "string"},
                "x": {"type": "string"},
                "y": {"type": "string"},
            },
            "required": ["interpretation", "plot_type"],
        },
    ),
    system_instruction=[Part.from_text(system_instruction)],
)
